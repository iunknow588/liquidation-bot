# 🔧 快速修复：版本号和数据显示问题

## 🎯 问题诊断

### 问题 1: 标题不显示版本时间
**症状**: 页面标题显示 `v1.0.0` 而不是 `v1.0.0 (10-28 21:30)`

**原因**: Vercel 环境变量未配置

### 问题 2: 没有显示账户数据
**症状**: 点击"开始扫描"后没有账户列表

**原因**: 
1. RPC 连接失败
2. Solend 程序在当前网络上没有账户
3. API 调用错误

---

## ✅ 解决方案

### 方案 A: 本地测试（推荐先执行）

```bash
# 1. 进入项目目录
cd /home/lc/luckee_dao/solana-liquidation-dashboard

# 2. 同步配置
./sync-config.sh

# 3. 安装依赖
npm install

# 4. 本地运行
npm run dev

# 5. 访问测试
# http://localhost:3000
# http://localhost:3000/debug  ← 查看环境变量
```

**预期结果**:
- 标题显示：`v1.0.0 (10-28 21:30)`
- 访问 /debug 页面能看到所有环境变量

### 方案 B: Vercel 部署修复

#### 步骤 1: 配置环境变量（两种方式）

**方式 1: 使用脚本（推荐）**

```bash
cd /home/lc/luckee_dao/solana-liquidation-dashboard

# 确保已登录 Vercel
vercel login

# 运行配置脚本
./scripts/setup-vercel-env.sh
```

**方式 2: 手动配置**

1. 访问 https://vercel.com/dashboard
2. 进入项目：solana-liquidation-dashboard
3. 进入 Settings → Environment Variables
4. 添加以下变量（Production 和 Preview）:

```ini
# 版本信息（NEXT_PUBLIC_ 前缀，前端可见）
NEXT_PUBLIC_VERSION_MAJOR=1
NEXT_PUBLIC_VERSION_MINOR=0
NEXT_PUBLIC_VERSION_PATCH=0
NEXT_PUBLIC_VERSION_PREFIX=v
NEXT_PUBLIC_VERSION_COMMIT_TIME=10-28 21:30

# Solana 配置（服务器端）
SOLANA_CLUSTER=mainnet
SOLANA_MAINNET_RPC=https://api.mainnet-beta.solana.com
SOLANA_DEVNET_RPC=https://api.devnet.solana.com
SOLANA_TESTNET_RPC=https://api.testnet.solana.com

# API Key（服务器端，私密）
HELIUS_API_KEY=08108945-f5b2-4aa4-8453-58e16774c9ba
```

#### 步骤 2: 重新部署

```bash
# 方式 1: 通过 Git 推送触发
git add .
git commit -m "🔧 fix: 添加环境变量和调试页面"
git push origin master

# 方式 2: 直接使用 Vercel CLI
cd /home/lc/luckee_dao/solana-liquidation-dashboard
vercel --prod --yes
```

#### 步骤 3: 验证

1. 等待 2-3 分钟部署完成
2. 访问 https://sbot.cdao.online/
3. 访问 https://sbot.cdao.online/debug

**预期结果**:
```
主页面:
  标题: 🚀 Solana 清算机器人 [ v1.0.0 (10-28 21:30) ]

/debug 页面:
  VERSION_MAJOR: "1"
  VERSION_MINOR: "0"
  VERSION_PATCH: "0"
  VERSION_PREFIX: "v"
  VERSION_COMMIT_TIME: "10-28 21:30"
```

---

## 🔍 数据显示问题排查

### 检查 1: RPC 连接

访问主页，点击"开始扫描"，查看是否显示：

```
✅ RPC 连接成功
📡 RPC 提供商: Solana 公开节点 (Mainnet)
🔢 当前 Slot: [一个大数字]
```

- **如果显示** → RPC 连接正常
- **如果不显示** → 检查网络或 RPC 配置

### 检查 2: 账户查询

查看是否显示：

```
📊 扫描结果
总账户: X 个
```

**情况 A: 总账户 > 0**
- ✅ 正常！应该能看到账户列表

**情况 B: 总账户 = 0**
- ✅ 也是正常的！说明：
  - Solend 在当前网络上确实没有账户
  - 或者所有账户都很健康
  - RPC 连接和查询功能都工作正常

**情况 C: 显示错误**
- ❌ 需要检查：
  1. 浏览器 Console (F12)
  2. Vercel Functions 日志
  3. 网络请求详情

### 检查 3: Vercel Logs

1. 访问 https://vercel.com/dashboard
2. 进入项目 → Functions
3. 查看最新日志

**正常日志应该包含**:
```
[API] 使用 RPC: Solana 公开节点 (Mainnet)
[API] 测试 RPC 连接...
[API] ✅ RPC 连接成功！当前 Slot: 123456789
[API] 开始查询 Solend 程序账户...
[API] ✅ 成功获取 X 个 Solend 账户
```

---

## 📝 快速命令清单

### 本地开发

```bash
# 完整流程
cd /home/lc/luckee_dao/solana-liquidation-dashboard
./sync-config.sh
npm install
npm run dev
# 访问 http://localhost:3000
```

### Vercel 部署

```bash
# 方法 1: 配置环境变量后推送
./scripts/setup-vercel-env.sh
git add .
git commit -m "🔧 fix: 环境变量配置"
git push origin master

# 方法 2: 直接部署
vercel --prod --yes
```

### 调试

```bash
# 查看本地环境变量
cat .env.local | grep VERSION

# 访问调试页面
# 本地: http://localhost:3000/debug
# 线上: https://sbot.cdao.online/debug
```

---

## ⚠️ 常见问题

### Q1: 本地可以，Vercel 不行？
**A**: Vercel 环境变量未配置，执行 `./scripts/setup-vercel-env.sh`

### Q2: 版本号显示 v?.?.?
**A**: 环境变量未读取，检查：
1. `.env.local` 文件是否存在
2. 环境变量名称是否正确（必须是 `NEXT_PUBLIC_` 前缀）
3. 是否重新构建了项目

### Q3: 0 个账户正常吗？
**A**: ✅ 完全正常！这说明：
- RPC 连接成功
- 查询功能正常
- 只是当前网络上确实没有 Solend 账户

### Q4: 如何切换网络？
**A**: 修改 `env/.info` 中的 `SOLANA_CLUSTER`:
```ini
SOLANA_CLUSTER=devnet   # 或 testnet, mainnet
```
然后重新同步和部署。

---

## 🎯 验证清单

完成修复后，检查以下项目：

- [ ] 本地 npm run dev 可以显示版本号
- [ ] 访问 /debug 能看到所有环境变量
- [ ] 点击"开始扫描"能看到 RPC 连接状态
- [ ] Vercel 部署后版本号正确显示
- [ ] Vercel /debug 页面环境变量正确
- [ ] 能看到扫描结果（有或无账户都是正常的）

---

## 📞 技术支持

如果问题仍未解决：

1. **检查 Vercel Logs**
   - Dashboard → Project → Functions
   
2. **检查浏览器 Console**
   - F12 → Console 标签
   
3. **查看环境变量**
   - 访问 /debug 页面
   
4. **提供详细信息**
   - 错误信息截图
   - Vercel Logs
   - 浏览器 Console 输出

---

**快速开始**: 运行 `./sync-config.sh && npm run dev` 然后访问 http://localhost:3000

