# 🔄 重新部署指南

**情况**: 代码已更新并推送到 GitHub，需要重新部署到 Vercel

**时间**: 2025-10-28

---

## ✅ 已完成

- ✅ 代码已更新（优化 RPC 节点选择）
- ✅ 已提交到 Git (commit: 3b7042b)
- ✅ 已推送到 GitHub

---

## 🚀 方法 1: 自动部署（Vercel 自动检测）

Vercel 已连接到 GitHub 仓库，**应该会自动触发部署**！

**检查方法**:

1. **用手机访问 Vercel Dashboard**:
   ```
   https://vercel.com/iunknow588s-projects/solana-liquidation-dashboard
   ```

2. **查看 Deployments 标签**:
   - 应该看到新的部署正在进行
   - 状态: "Building" → "Ready"
   - 时间: 最近几分钟

3. **等待完成**（约 1-2 分钟）

---

## 🚀 方法 2: 手动触发部署

如果自动部署没有触发，可以手动触发：

### 选项 A: 在 Vercel Dashboard 手动部署

1. **用手机访问**:
   ```
   https://vercel.com/iunknow588s-projects/solana-liquidation-dashboard
   ```

2. **点击 "Deployments" 标签**

3. **点击右上角的三个点 (...)**

4. **选择 "Redeploy"**

5. **确认部署**

### 选项 B: 通过 Git 提交触发

如果上述方法不行，可以做一个空提交：

```bash
# 在有网络的环境（手机/其他设备）运行:
cd /home/lc/luckee_dao/solana-liquidation-dashboard
git commit --allow-empty -m "🔄 触发重新部署"
git push origin master
```

Vercel 会自动检测到并部署。

---

## 🧪 方法 3: 使用 Vercel CLI（如果有网络）

```bash
# 需要先启动代理
export http_proxy=http://192.168.160.1:7890
export https_proxy=http://192.168.160.1:7890

cd /home/lc/luckee_dao/solana-liquidation-dashboard
vercel --prod --yes
```

**注意**: 本地网络受限，此方法可能超时。

---

## 📊 部署状态检查

### ✅ 部署成功的标志

**在 Vercel Dashboard 看到**:
```
✅ Production Deployment
✅ Status: Ready
✅ Domain: solana-liquidation-dashboard-xxx.vercel.app
✅ Last Updated: [最近时间]
```

### 查看部署日志

1. 点击最新的 Deployment
2. 查看 **Build Logs**
3. 应该看到:
   ```
   ✓ Compiled successfully
   ✓ Optimized for production
   ✓ Deployment ready
   ```

---

## 🔍 验证更新

### 检查代码是否更新

**方法 1: 查看 GitHub**
```
https://github.com/iunknow588/liquidation-bot/commits/master
```

应该看到最新提交:
```
✨ feat: 优化 RPC 节点选择逻辑
Commit: 3b7042b
Time: [最近时间]
```

**方法 2: 查看 API 响应**

用手机访问:
```
https://solana-liquidation-dashboard-xxx.vercel.app/api/scan
```

应该看到新的字段:
```json
{
  "status": "ok",
  "cluster": "devnet",
  "provider": "Solana 公开节点 (Devnet)",  // 新增
  "usingPublicRpc": true,                   // 新增
  ...
}
```

---

## ⚙️ 配置环境变量

**重要**: 在 Vercel Dashboard 配置环境变量

### 方案 1: 使用公开节点（推荐）✅

```
只保留:
SOLANA_CLUSTER = mainnet

删除:
HELIUS_API_KEY (删除此变量)
```

**效果**: 使用 Solana 公开节点（免费）

### 方案 2: 使用 Helius

```
保留:
SOLANA_CLUSTER = mainnet
HELIUS_API_KEY = 08108945-f5b2-4aa4-8453-58e16774c9ba
```

**效果**: 使用 Helius RPC

### 配置步骤

1. 访问: Settings → Environment Variables
2. 修改或删除变量
3. 点击 Save
4. 触发重新部署（方法 2）

---

## 🎯 完整流程

### 理想情况（自动部署）

```
1. 代码推送到 GitHub ✅ (已完成)
   ↓
2. Vercel 检测到更新 ✅ (自动)
   ↓
3. 自动开始构建 ✅ (自动, 1-2分钟)
   ↓
4. 部署完成 ✅ (自动)
   ↓
5. 访问新版本 ✅
```

### 需要手动操作的情况

```
1. 代码推送到 GitHub ✅ (已完成)
   ↓
2. 手机访问 Vercel Dashboard
   ↓
3. 点击 "Redeploy"
   ↓
4. 等待构建完成 (1-2分钟)
   ↓
5. 访问新版本 ✅
```

---

## 🧪 测试连接

### 测试 1: 健康检查

**URL**:
```
https://solana-liquidation-dashboard-9jvln3o2e-iunknow588s-projects.vercel.app/api/scan
```

**用手机访问**，应该看到:
```json
{
  "status": "ok",
  "cluster": "devnet",
  "provider": "Solana 公开节点 (Devnet)",
  "hasApiKey": false,
  "usingPublicRpc": true,
  "timestamp": 1730xxx
}
```

**如果看到**:
- ✅ `"usingPublicRpc": true` → 使用公开节点
- ✅ `"provider": "Solana 公开节点 (Devnet)"` → 显示节点信息

### 测试 2: 访问主页

**URL**:
```
https://solana-liquidation-dashboard-9jvln3o2e-iunknow588s-projects.vercel.app
```

**用手机访问**，应该看到:
- ✅ 页面正常加载
- ✅ 显示 "Solana 清算机器人"
- ✅ 显示集群信息
- ✅ 有 "开始扫描" 按钮

### 测试 3: 扫描功能

1. 点击 "开始扫描"
2. 等待几秒
3. 应该返回数据（可能为 0 个账户，这是正常的）

---

## ❓ 故障排除

### 问题 1: 本地无法访问

**症状**: curl 超时
```bash
$ curl https://your-app.vercel.app
timeout
```

**原因**: 本地网络受限

**解决**: ✅ 用手机测试（移动网络）

### 问题 2: 部署没有自动触发

**症状**: Vercel Dashboard 没有新的部署

**解决**:
1. 检查 GitHub 是否有最新提交
2. 在 Vercel 手动点击 "Redeploy"
3. 或执行空提交触发部署

### 问题 3: 部署失败

**症状**: Build Logs 显示错误

**解决**:
1. 查看详细错误日志
2. 检查环境变量配置
3. 查看 GitHub 代码是否正确

### 问题 4: API 返回 500 错误

**症状**: `/api/scan` 返回错误

**可能原因**:
- 环境变量未配置
- RPC 节点无法访问
- 代码错误

**解决**:
1. 查看 Vercel Functions 日志
2. 检查环境变量
3. 测试 RPC 连接

---

## 📊 预期结果

### GitHub

```
✅ Commit: 3b7042b
✅ Message: ✨ feat: 优化 RPC 节点选择逻辑
✅ Files: 2 changed
✅ Status: Pushed to master
```

### Vercel

```
✅ Status: Ready
✅ Build: Successful
✅ Domain: Active
✅ Functions: Deployed
```

### 应用

```
✅ 主页可访问
✅ API 端点工作
✅ 显示正确的节点信息
✅ 扫描功能正常
```

---

## 🎯 立即行动

### 步骤 1: 检查 Vercel（必须）

**用手机访问**:
```
https://vercel.com/iunknow588s-projects/solana-liquidation-dashboard
```

查看是否有新的部署正在进行。

### 步骤 2: 如果没有自动部署

点击 "Redeploy" 手动触发。

### 步骤 3: 等待部署完成

通常 1-2 分钟。

### 步骤 4: 测试应用

访问应用 URL，测试功能。

---

## ✅ 总结

**当前状态**:
- ✅ 代码已更新
- ✅ 已推送到 GitHub
- ⏳ 等待 Vercel 部署

**下一步**:
1. 用手机查看 Vercel 部署状态
2. 如需手动触发，点击 "Redeploy"
3. 等待部署完成
4. 测试新版本

**时间**: 约 5 分钟

---

**注意**: 由于本地网络受限，所有测试都需要通过手机（移动网络）进行！

